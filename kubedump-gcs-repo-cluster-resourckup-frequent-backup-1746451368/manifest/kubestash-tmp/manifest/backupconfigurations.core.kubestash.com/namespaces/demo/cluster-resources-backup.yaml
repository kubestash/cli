apiVersion: core.kubestash.com/v1alpha1
kind: BackupConfiguration
metadata:
  annotations:
    kubectl.kubernetes.io/last-applied-configuration: |
      {"apiVersion":"core.kubestash.com/v1alpha1","kind":"BackupConfiguration","metadata":{"annotations":{},"name":"cluster-resources-backup","namespace":"demo"},"spec":{"backends":[{"name":"gcs-backend","retentionPolicy":{"name":"demo-retention","namespace":"demo"},"storageRef":{"name":"gcs-storage","namespace":"demo"}}],"sessions":[{"addon":{"jobTemplate":{"spec":{"serviceAccountName":"cluster-resource-reader-writter"}},"name":"kubedump-addon","tasks":[{"name":"manifest-backup","params":{"IncludeClusterResources":"true"}}]},"name":"frequent-backup","repositories":[{"backend":"gcs-backend","deletionPolicy":"Retain","directory":"/cluster-backup","encryptionSecret":{"name":"encrypt-secret","namespace":"demo"},"name":"kubedump-gcs-repo"}],"scheduler":{"jobTemplate":{"backoffLimit":1},"schedule":"*/5 * * * *"},"sessionHistoryLimit":1}]}}
  finalizers:
  - kubestash.com/cleanup
  name: cluster-resources-backup
  namespace: demo
spec:
  backends:
  - name: gcs-backend
    retentionPolicy:
      name: demo-retention
      namespace: demo
    storageRef:
      name: gcs-storage
      namespace: demo
  sessions:
  - addon:
      jobTemplate:
        controller: {}
        metadata: {}
        spec:
          resources: {}
          serviceAccountName: cluster-resource-reader-writter
      name: kubedump-addon
      tasks:
      - name: manifest-backup
        params:
          IncludeClusterResources: "true"
    name: frequent-backup
    repositories:
    - backend: gcs-backend
      deletionPolicy: Retain
      directory: /cluster-backup
      encryptionSecret:
        name: encrypt-secret
        namespace: demo
      name: kubedump-gcs-repo
    scheduler:
      jobTemplate:
        backoffLimit: 1
        template:
          controller: {}
          metadata: {}
          spec:
            resources: {}
      schedule: '*/5 * * * *'
    sessionHistoryLimit: 1
status:
  backends:
  - name: gcs-backend
    ready: true
    retentionPolicy:
      found: true
      ref:
        name: demo-retention
        namespace: demo
    storage:
      phase: Ready
      ref:
        name: gcs-storage
        namespace: demo
  conditions:
  - lastTransitionTime: "2025-05-05T13:22:48Z"
    message: Validation has been passed successfully.
    reason: ResourceValidationPassed
    status: "True"
    type: ValidationPassed
  dependencies:
  - found: true
    kind: Addon
    name: kubedump-addon
  phase: Ready
  repositories:
  - name: kubedump-gcs-repo
    phase: Ready
  sessions:
  - conditions:
    - lastTransitionTime: "2025-05-05T13:22:48Z"
      message: Scheduler has been ensured successfully.
      reason: SchedulerEnsured
      status: "True"
      type: SchedulerEnsured
    - lastTransitionTime: "2025-05-05T13:22:49Z"
      message: Initial backup has been triggered successfully.
      reason: SuccessfullyTriggeredInitialBackup
      status: "True"
      type: InitialBackupTriggered
    name: frequent-backup
  targetFound: true
